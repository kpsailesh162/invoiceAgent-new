2025-02-01 21:39:56,555 - __main__ - INFO - Starting comprehensive data generation
2025-02-01 21:39:56,555 - __main__ - INFO - Generating master ERP data...
2025-02-01 21:39:56,556 - __main__ - INFO - Verified ERP mock data file: vendors.json
2025-02-01 21:39:56,556 - __main__ - INFO - Verified ERP mock data file: purchase_orders.json
2025-02-01 21:39:56,556 - __main__ - INFO - Verified ERP mock data file: goods_receipts.json
2025-02-01 21:39:56,556 - __main__ - INFO - Generating production-like invoices...
2025-02-01 21:39:56,626 - __main__ - INFO - Data generation completed successfully
2025-02-04 21:07:48,310 - invoice_agent.security.auth - INFO - AuthManager initialized with redirect URI: http://localhost:8502
2025-02-04 21:07:48,311 - invoice_agent.security.auth - DEBUG - Google Client ID configured: True
2025-02-04 21:07:48,311 - invoice_agent.security.auth - DEBUG - Google Client Secret configured: True
2025-02-04 21:07:48,334 - invoice_agent.security.auth - INFO - AuthManager initialized with redirect URI: http://localhost:8502
2025-02-04 21:07:48,335 - invoice_agent.security.auth - DEBUG - Google Client ID configured: True
2025-02-04 21:07:48,335 - invoice_agent.security.auth - DEBUG - Google Client Secret configured: True
2025-02-04 21:07:49,125 - invoice_agent.ui.app - ERROR - Main application error: st.session_state has no attribute "authenticated". Did you forget to initialize it? More info: https://docs.streamlit.io/library/advanced-features/session-state#initialization
Traceback (most recent call last):
  File "/Users/sailesh/Documents/GitHub/aiagent/venv/lib/python3.12/site-packages/streamlit/runtime/state/session_state.py", line 394, in __getitem__
    return self._getitem(widget_id, key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/sailesh/Documents/GitHub/aiagent/venv/lib/python3.12/site-packages/streamlit/runtime/state/session_state.py", line 439, in _getitem
    raise KeyError
KeyError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/sailesh/Documents/GitHub/aiagent/venv/lib/python3.12/site-packages/streamlit/runtime/state/session_state_proxy.py", line 119, in __getattr__
    return self[key]
           ~~~~^^^^^
  File "/Users/sailesh/Documents/GitHub/aiagent/venv/lib/python3.12/site-packages/streamlit/runtime/state/session_state_proxy.py", line 90, in __getitem__
    return get_session_state()[key]
           ~~~~~~~~~~~~~~~~~~~^^^^^
  File "/Users/sailesh/Documents/GitHub/aiagent/venv/lib/python3.12/site-packages/streamlit/runtime/state/safe_session_state.py", line 89, in __getitem__
    return self._state[key]
           ~~~~~~~~~~~^^^^^
  File "/Users/sailesh/Documents/GitHub/aiagent/venv/lib/python3.12/site-packages/streamlit/runtime/state/session_state.py", line 396, in __getitem__
    raise KeyError(_missing_key_error_message(key))
KeyError: 'st.session_state has no key "authenticated". Did you forget to initialize it? More info: https://docs.streamlit.io/library/advanced-features/session-state#initialization'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/sailesh/Documents/GitHub/invoiceAgent/src/invoice_agent/ui/app.py", line 1220, in main
    if not st.session_state.authenticated:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/sailesh/Documents/GitHub/aiagent/venv/lib/python3.12/site-packages/streamlit/runtime/state/session_state_proxy.py", line 121, in __getattr__
    raise AttributeError(_missing_attr_error_message(key))
AttributeError: st.session_state has no attribute "authenticated". Did you forget to initialize it? More info: https://docs.streamlit.io/library/advanced-features/session-state#initialization
2025-02-04 21:08:10,436 - invoice_agent.security.auth - INFO - AuthManager initialized with redirect URI: http://localhost:8502
2025-02-04 21:08:10,436 - invoice_agent.security.auth - DEBUG - Google Client ID configured: True
2025-02-04 21:08:10,436 - invoice_agent.security.auth - DEBUG - Google Client Secret configured: True
2025-02-04 21:08:10,453 - invoice_agent.security.auth - INFO - AuthManager initialized with redirect URI: http://localhost:8502
2025-02-04 21:08:10,453 - invoice_agent.security.auth - DEBUG - Google Client ID configured: True
2025-02-04 21:08:10,453 - invoice_agent.security.auth - DEBUG - Google Client Secret configured: True
2025-02-04 21:08:12,600 - invoice_agent.security.auth - INFO - AuthManager initialized with redirect URI: http://localhost:8502
2025-02-04 21:08:12,601 - invoice_agent.security.auth - DEBUG - Google Client ID configured: True
2025-02-04 21:08:12,601 - invoice_agent.security.auth - DEBUG - Google Client Secret configured: True
2025-02-04 21:08:13,248 - __main__ - INFO - Initiating Google OAuth flow...
2025-02-04 21:08:13,248 - invoice_agent.security.auth - DEBUG - Generated new state token: iX_UQJZ9GX...
2025-02-04 21:08:13,248 - invoice_agent.security.auth - DEBUG - Using redirect URI: http://localhost:8502
2025-02-04 21:08:13,248 - invoice_agent.security.auth - INFO - Generated auth URL with state token: iX_UQJZ9GX...
2025-02-04 21:08:13,248 - __main__ - DEBUG - Generated auth URL: https://accounts.google.com/o/oauth2/v2/auth?client_id=183173833346-kmsle3f3phtd3f71jms96q3uvcoqv0vu.apps.googleusercontent.com&redirect_uri=http%3A%2F%2Flocalhost%3A8502&response_type=code&scope=openid+email+profile&access_type=offline&state=iX_UQJZ9GXj2qB3vosWuqIVusFmkhA94NEERI7kbbX4&prompt=consent&include_granted_scopes=true
2025-02-04 21:08:13,249 - __main__ - DEBUG - Session state before redirect: {'user_info': None, 'auth_flow_started': True, 'google_signin': True, 'page': 'Dashboard', 'initialized': True, 'last_activity': 1738721293.2472162, 'authenticated': False, 'connection_attempts': 0, 'auth_error': None, 'auth_state': {'state_token': 'iX_UQJZ9GXj2qB3vosWuqIVusFmkhA94NEERI7kbbX4', 'auth_flow_started': True, 'auth_in_progress': True}}
2025-02-04 21:12:46,344 - invoice_agent.security.auth - INFO - User registered successfully: saileshkp
2025-02-04 21:12:46,344 - __main__ - ERROR - Main application error: `st.session_state.signup_username` cannot be modified after the widget with key `signup_username` is instantiated.
Traceback (most recent call last):
  File "/Users/sailesh/Documents/GitHub/invoiceAgent/src/invoice_agent/ui/app.py", line 1241, in main
    show_auth_page()
  File "/Users/sailesh/Documents/GitHub/invoiceAgent/src/invoice_agent/ui/app.py", line 333, in show_auth_page
    st.session_state.signup_username = ""
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/sailesh/Documents/GitHub/aiagent/venv/lib/python3.12/site-packages/streamlit/runtime/metrics_util.py", line 396, in wrapped_func
    result = non_optional_func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/sailesh/Documents/GitHub/aiagent/venv/lib/python3.12/site-packages/streamlit/runtime/state/session_state_proxy.py", line 125, in __setattr__
    self[key] = value
    ~~~~^^^^^
  File "/Users/sailesh/Documents/GitHub/aiagent/venv/lib/python3.12/site-packages/streamlit/runtime/metrics_util.py", line 396, in wrapped_func
    result = non_optional_func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/sailesh/Documents/GitHub/aiagent/venv/lib/python3.12/site-packages/streamlit/runtime/state/session_state_proxy.py", line 103, in __setitem__
    get_session_state()[key] = value
    ~~~~~~~~~~~~~~~~~~~^^^^^
  File "/Users/sailesh/Documents/GitHub/aiagent/venv/lib/python3.12/site-packages/streamlit/runtime/state/safe_session_state.py", line 94, in __setitem__
    self._state[key] = value
    ~~~~~~~~~~~^^^^^
  File "/Users/sailesh/Documents/GitHub/aiagent/venv/lib/python3.12/site-packages/streamlit/runtime/state/session_state.py", line 457, in __setitem__
    raise StreamlitAPIException(
streamlit.errors.StreamlitAPIException: `st.session_state.signup_username` cannot be modified after the widget with key `signup_username` is instantiated.
2025-02-04 21:17:49,189 - invoice_agent.security.auth - INFO - Database initialized successfully
2025-02-04 21:17:49,217 - invoice_agent.security.auth - ERROR - User registration error: column "username" of relation "users" does not exist
LINE 1: INSERT INTO users (username, email, password_hash) VALUES ('...
                           ^

2025-02-04 21:20:18,155 - invoice_agent.security.auth - INFO - Database initialized successfully
2025-02-04 21:20:18,176 - invoice_agent.security.auth - INFO - User registered successfully: saileshkp
2025-02-04 21:20:43,610 - invoice_agent.security.auth - INFO - Database initialized successfully
2025-02-04 21:20:43,635 - invoice_agent.security.auth - INFO - Database initialized successfully
2025-02-04 21:41:05,313 - invoice_agent.security.auth - INFO - Database initialized successfully
2025-02-04 21:41:05,571 - invoice_agent.security.auth - INFO - User registered successfully: saileshkp
