2025-02-01 22:16:36,857 - audit - INFO - {"timestamp": "2025-02-01T22:16:36.857502", "event_id": "a4ceb055-6582-4191-97c2-b689f7f629ea", "event_type": "workflow_state_change", "environment": "development", "user_id": "demo_client", "correlation_id": "ab85293a-46f7-4909-8517-51c6d555b704", "details": {"workflow_id": "a46fd00e-8b3c-403e-a951-8104c116f2cc", "status": "created", "template_id": "default", "document_path": "temp_invoice_INV1000_normal.pdf"}}
2025-02-01 22:16:36,870 - audit - INFO - {"timestamp": "2025-02-01T22:16:36.870616", "event_id": "a2b9d7bc-4d35-4e6c-8db8-d2e622159fe7", "event_type": "workflow_state_change", "environment": "development", "user_id": "demo_client", "correlation_id": "28b6b0c6-252d-4eb7-a8fc-ee3d72ee6f58", "details": {"workflow_id": "a46fd00e-8b3c-403e-a951-8104c116f2cc", "status": "status_change", "previous_status": "created", "new_status": "completed", "message": null, "error": null}}
2025-02-01 22:22:53,368 - audit - INFO - {"timestamp": "2025-02-01T22:22:53.368334", "event_id": "99baedb7-f28c-41c3-a69f-ec963003ffef", "event_type": "workflow_state_change", "environment": "development", "user_id": "demo_client", "correlation_id": "cd2094e6-4772-4e6e-95f5-eeeb39fd63a6", "details": {"workflow_id": "ba8ec932-ae70-4f56-9cd4-04957d2647f6", "status": "created", "template_id": "default", "document_path": "temp_invoice_INV1002_normal.pdf"}}
2025-02-01 22:22:53,373 - audit - INFO - {"timestamp": "2025-02-01T22:22:53.373682", "event_id": "509420b0-95ce-4aa7-b864-bb7c88847564", "event_type": "workflow_state_change", "environment": "development", "user_id": "demo_client", "correlation_id": "cb037eec-66db-43c5-8bf7-894416f05567", "details": {"workflow_id": "ba8ec932-ae70-4f56-9cd4-04957d2647f6", "status": "status_change", "previous_status": "created", "new_status": "completed", "message": null, "error": null}}
2025-02-01 22:31:43,996 - audit - INFO - {"timestamp": "2025-02-01T22:31:43.996786", "event_id": "ed4d33a5-fea7-4b65-8c3a-3f2d9e642939", "event_type": "workflow_state_change", "environment": "development", "user_id": "demo_client", "correlation_id": "e7dcdcfd-2090-45ef-980c-25fdc9864bb9", "details": {"workflow_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "status": "created", "template_id": "default", "document_path": "temp_invoice_INV1004_normal.pdf"}}
2025-02-01 22:31:43,997 - audit - INFO - {"timestamp": "2025-02-01T22:31:43.997377", "event_id": "df676f51-c34d-4883-916c-4cde4cab2b9f", "event_type": "workflow_state_change", "environment": "development", "user_id": "demo_client", "correlation_id": "784c8dfa-0d62-40e9-a010-b2fa33e23a02", "details": {"workflow_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "status": "status_change", "previous_status": "created", "new_status": "loading", "message": "Loading document for processing", "error": null}}
2025-02-01 22:31:44,000 - audit - INFO - {"timestamp": "2025-02-01T22:31:44.000860", "event_id": "f3cb2eb8-4440-4f61-82f3-9879f859f164", "event_type": "workflow_state_change", "environment": "development", "user_id": "demo_client", "correlation_id": "b700fdd2-9817-4e78-956a-3dc79fcd97f5", "details": {"workflow_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "status": "status_change", "previous_status": "loading", "new_status": "processing", "message": "Extracting data from document", "error": null}}
2025-02-01 22:31:44,001 - audit - INFO - {"timestamp": "2025-02-01T22:31:44.001556", "event_id": "a3f7ef31-94d5-4857-8f2a-8937be90d709", "event_type": "workflow_state_change", "environment": "development", "user_id": "demo_client", "correlation_id": "c0558891-c0f6-410b-bef2-935f0ab1c3c8", "details": {"workflow_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "status": "updated", "updated_fields": ["extraction_results"]}}
2025-02-01 22:31:44,002 - audit - INFO - {"timestamp": "2025-02-01T22:31:44.002048", "event_id": "568c52ae-4b9b-4b72-aee2-d8bc5933c014", "event_type": "workflow_state_change", "environment": "development", "user_id": "demo_client", "correlation_id": "41151106-9355-4df2-ac1c-8a8e9feb87f2", "details": {"workflow_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "status": "status_change", "previous_status": "processing", "new_status": "validating", "message": "Validating extracted data", "error": null}}
2025-02-01 22:31:44,002 - audit - INFO - {"timestamp": "2025-02-01T22:31:44.002685", "event_id": "53a9b698-3dba-4973-bdbc-5aa54e0ddb86", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "0e3c8002-6ec1-493c-bae5-0a82b4f88b9e", "details": {"resource_type": "workflow", "resource_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "action": "read"}}
2025-02-01 22:31:44,003 - audit - INFO - {"timestamp": "2025-02-01T22:31:44.003512", "event_id": "4d2c31c0-79e2-42f0-8f20-14f21224fda9", "event_type": "workflow_state_change", "environment": "development", "user_id": "demo_client", "correlation_id": "e13f9f78-592f-4560-a78f-8d0e18958e5a", "details": {"workflow_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "status": "status_change", "previous_status": "validating", "new_status": "completed", "message": "Processing completed successfully", "error": null}}
2025-02-01 22:31:44,076 - audit - INFO - {"timestamp": "2025-02-01T22:31:44.076628", "event_id": "4e71e384-dc87-46b1-b2dc-efcf22e2f85a", "event_type": "workflow_state_change", "environment": "development", "user_id": "demo_client", "correlation_id": "41412465-e1ce-4ab0-a845-cc648db439d8", "details": {"workflow_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "status": "updated", "updated_fields": ["processing_time"]}}
2025-02-02 00:05:51,301 - audit - INFO - {"timestamp": "2025-02-02T00:05:51.301576", "event_id": "497e0662-0daf-444d-b0f7-35d6ead91966", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "07a310ce-8990-441d-be9c-29990b8a73a3", "details": {"resource_type": "workflow", "resource_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "action": "read"}}
2025-02-02 00:07:35,503 - audit - INFO - {"timestamp": "2025-02-02T00:07:35.503035", "event_id": "7a53abae-beee-4303-a65b-efc5ccfb5195", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "bd223c73-c478-4001-af6a-999c2ec4a3ce", "details": {"resource_type": "workflow", "resource_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "action": "read"}}
2025-02-02 00:07:35,506 - audit - INFO - {"timestamp": "2025-02-02T00:07:35.506451", "event_id": "95686952-f9ad-4586-9aa7-d65b108c36da", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "0244d304-a528-4098-9a69-73bd29c9a187", "details": {"resource_type": "workflow", "resource_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "action": "read"}}
2025-02-02 00:09:49,197 - audit - INFO - {"timestamp": "2025-02-02T00:09:49.197450", "event_id": "296b4446-9aa1-4b13-818f-03d61fa56c87", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "cbc4c91a-41bb-4fb9-a45e-4deacd82441c", "details": {"resource_type": "workflow", "resource_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "action": "read"}}
2025-02-02 00:09:49,273 - audit - INFO - {"timestamp": "2025-02-02T00:09:49.273291", "event_id": "a0f171b0-2747-4da8-871c-5b1748230a55", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "d976078c-cec4-443f-84cd-ca8c797d3d5c", "details": {"resource_type": "workflow", "resource_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "action": "read"}}
2025-02-02 00:09:49,273 - audit - INFO - {"timestamp": "2025-02-02T00:09:49.273929", "event_id": "e184bf79-4eef-432a-80b0-bfacc054427a", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "6ef66608-b479-46ab-9262-1389a6a3842b", "details": {"resource_type": "workflow", "resource_id": "ba8ec932-ae70-4f56-9cd4-04957d2647f6", "action": "read"}}
2025-02-02 00:09:49,274 - audit - INFO - {"timestamp": "2025-02-02T00:09:49.274434", "event_id": "f2294b21-d5ed-4155-97c1-e15e4858e1b9", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "941f5e4a-4bdf-428a-878a-66577c3b7f7d", "details": {"resource_type": "workflow", "resource_id": "a46fd00e-8b3c-403e-a951-8104c116f2cc", "action": "read"}}
2025-02-02 00:14:34,538 - audit - INFO - {"timestamp": "2025-02-02T00:14:34.532235", "event_id": "e882ca79-1ce7-4c13-82de-1c2bd3001ef4", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "859370d9-7ec5-4e0f-9041-1d0df0c658bb", "details": {"resource_type": "workflow", "resource_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "action": "read"}}
2025-02-02 00:14:34,540 - audit - INFO - {"timestamp": "2025-02-02T00:14:34.540125", "event_id": "1b09d3a0-e13a-4e72-b358-feb4abfbfba1", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "cc6abaa7-fb99-4a75-ac45-669be9098f3b", "details": {"resource_type": "workflow", "resource_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "action": "read"}}
2025-02-02 00:14:34,540 - audit - INFO - {"timestamp": "2025-02-02T00:14:34.540946", "event_id": "e47980a9-367d-405b-82b3-1c014f3fbd76", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "e6572356-267c-4dc0-8d3c-2d9fce810862", "details": {"resource_type": "workflow", "resource_id": "ba8ec932-ae70-4f56-9cd4-04957d2647f6", "action": "read"}}
2025-02-02 00:14:34,541 - audit - INFO - {"timestamp": "2025-02-02T00:14:34.541594", "event_id": "d7e23efd-2a22-41ac-af99-5723885e7c9b", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "7805d918-b5fb-4cbb-b2d5-942fd726fd2c", "details": {"resource_type": "workflow", "resource_id": "a46fd00e-8b3c-403e-a951-8104c116f2cc", "action": "read"}}
2025-02-02 00:16:23,614 - audit - INFO - {"timestamp": "2025-02-02T00:16:23.614770", "event_id": "c0a8918f-cbd2-4b50-af3a-0e6a41c69a07", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "0aa8a4b6-3273-4489-979d-c527cf96dcf0", "details": {"resource_type": "workflow", "resource_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "action": "read"}}
2025-02-02 00:16:23,694 - audit - INFO - {"timestamp": "2025-02-02T00:16:23.694491", "event_id": "17c25b42-30bb-4aa2-9893-99351d74f031", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "e9580462-24b5-451f-9a20-34d978d095ea", "details": {"resource_type": "workflow", "resource_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "action": "read"}}
2025-02-02 00:16:23,695 - audit - INFO - {"timestamp": "2025-02-02T00:16:23.695032", "event_id": "334a4e76-e527-4673-9981-8954c52afde5", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "b641138e-abc4-4f1f-8314-f067d1ae9278", "details": {"resource_type": "workflow", "resource_id": "ba8ec932-ae70-4f56-9cd4-04957d2647f6", "action": "read"}}
2025-02-02 00:16:23,695 - audit - INFO - {"timestamp": "2025-02-02T00:16:23.695362", "event_id": "64b427f8-3935-4e85-ae52-c6d75c00279e", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "a9a20d9d-1fc7-4d95-b8bc-6f6b300dbc8e", "details": {"resource_type": "workflow", "resource_id": "a46fd00e-8b3c-403e-a951-8104c116f2cc", "action": "read"}}
2025-02-02 00:28:18,029 - audit - INFO - {"timestamp": "2025-02-02T00:28:18.023666", "event_id": "46ed60d9-aa46-47c0-a4a3-f8e35807789c", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "effaf35c-4f56-4f61-bd0d-78775d136272", "details": {"resource_type": "workflow", "resource_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "action": "read"}}
2025-02-02 00:28:18,030 - audit - INFO - {"timestamp": "2025-02-02T00:28:18.030643", "event_id": "91954f67-1c60-4a9b-8650-48d4045019d5", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "2120f728-7751-4728-9e41-af23bd2f3d31", "details": {"resource_type": "workflow", "resource_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "action": "read"}}
2025-02-02 00:28:18,031 - audit - INFO - {"timestamp": "2025-02-02T00:28:18.031291", "event_id": "e7140182-e996-4756-b63f-9cf10e5779c3", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "f0d666b3-4295-4075-889e-7f6d45c540c9", "details": {"resource_type": "workflow", "resource_id": "ba8ec932-ae70-4f56-9cd4-04957d2647f6", "action": "read"}}
2025-02-02 00:28:18,031 - audit - INFO - {"timestamp": "2025-02-02T00:28:18.031784", "event_id": "6a2f4606-da00-4a4c-9111-ca20a56f37c6", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "2a96108a-f4fd-4a2c-8980-19b8aefda60b", "details": {"resource_type": "workflow", "resource_id": "a46fd00e-8b3c-403e-a951-8104c116f2cc", "action": "read"}}
2025-02-02 00:36:10,007 - audit - INFO - {"timestamp": "2025-02-02T00:36:10.007809", "event_id": "6b6089eb-7d20-4eb9-a464-fcafd5291206", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "332ed998-6d87-4901-9f07-e475628d034f", "details": {"resource_type": "workflow", "resource_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "action": "read"}}
2025-02-02 00:36:10,084 - audit - INFO - {"timestamp": "2025-02-02T00:36:10.084686", "event_id": "b7c3d6a7-df78-4a3c-891f-2e269f019066", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "bbed6e1c-bbda-4f21-b1e4-709ac0ba7e2b", "details": {"resource_type": "workflow", "resource_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "action": "read"}}
2025-02-02 00:36:10,085 - audit - INFO - {"timestamp": "2025-02-02T00:36:10.084997", "event_id": "28e56990-f4b5-411c-bb9e-46b52edf939c", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "c89279de-8012-4246-a13a-ca09491ef2fa", "details": {"resource_type": "workflow", "resource_id": "ba8ec932-ae70-4f56-9cd4-04957d2647f6", "action": "read"}}
2025-02-02 00:36:10,085 - audit - INFO - {"timestamp": "2025-02-02T00:36:10.085345", "event_id": "97394385-7052-4b54-a739-765dbf84b52f", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "4956b9b6-9432-464b-895b-c5b69d8283c5", "details": {"resource_type": "workflow", "resource_id": "a46fd00e-8b3c-403e-a951-8104c116f2cc", "action": "read"}}
2025-02-02 00:43:15,337 - audit - INFO - {"timestamp": "2025-02-02T00:43:15.337541", "event_id": "2aa72c1e-2084-4d5b-8180-276cc512b924", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "f19fe436-dc7f-4a7f-843d-0ca95cd0183a", "details": {"resource_type": "workflow", "resource_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "action": "read"}}
2025-02-02 00:43:15,338 - audit - INFO - {"timestamp": "2025-02-02T00:43:15.338212", "event_id": "a579581b-f047-406b-a36b-ad55eb0de7c6", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "4e7fd392-ee1b-49e1-ba16-6552cc061e49", "details": {"resource_type": "workflow", "resource_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "action": "read"}}
2025-02-02 00:43:15,338 - audit - INFO - {"timestamp": "2025-02-02T00:43:15.338329", "event_id": "2d35cb0e-210a-4851-9cd1-adba5b7c34ce", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "f0721bf6-6ef5-4008-8b4f-43f168c1907b", "details": {"resource_type": "workflow", "resource_id": "ba8ec932-ae70-4f56-9cd4-04957d2647f6", "action": "read"}}
2025-02-02 00:43:15,338 - audit - INFO - {"timestamp": "2025-02-02T00:43:15.338619", "event_id": "50872c46-21a4-434b-bbcf-faebbc815a4d", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "bd9338ca-c699-44df-af9e-ad9dca50052c", "details": {"resource_type": "workflow", "resource_id": "a46fd00e-8b3c-403e-a951-8104c116f2cc", "action": "read"}}
2025-02-02 00:48:47,185 - audit - INFO - {"timestamp": "2025-02-02T00:48:47.185134", "event_id": "fa373180-2604-4b54-8d6d-e8d2981ae96d", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "a9433810-f67b-40a6-8cce-cf873f5c1245", "details": {"resource_type": "workflow", "resource_id": "b57b096a-b0ba-4adf-b659-3947ad905498", "action": "read"}}
2025-02-02 00:48:47,307 - audit - INFO - {"timestamp": "2025-02-02T00:48:47.306978", "event_id": "1c880894-817b-4a80-8182-145f6b0cd7ce", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "c5f3e7bb-12c3-4b65-923e-ce2f036fcf87", "details": {"resource_type": "workflow", "resource_id": "ba8ec932-ae70-4f56-9cd4-04957d2647f6", "action": "read"}}
2025-02-02 00:48:47,307 - audit - INFO - {"timestamp": "2025-02-02T00:48:47.307270", "event_id": "d4bfeffc-0e54-4381-bf4e-a6dfebda9d5e", "event_type": "data_access", "environment": "development", "user_id": "demo_client", "correlation_id": "c1d05b4f-751a-40b0-b761-b08c8f0ab525", "details": {"resource_type": "workflow", "resource_id": "a46fd00e-8b3c-403e-a951-8104c116f2cc", "action": "read"}}
2025-02-04 20:58:08,773 - invoice_agent.security.auth - INFO - AuthManager initialized with redirect URI: http://localhost:8502
2025-02-04 20:58:08,773 - invoice_agent.security.auth - INFO - AuthManager initialized with redirect URI: http://localhost:8502
2025-02-04 20:58:08,773 - invoice_agent.security.auth - INFO - Using Streamlit port: 8502
2025-02-04 20:58:08,774 - invoice_agent.security.auth - INFO - Using Streamlit port: 8502
2025-02-04 20:58:08,774 - invoice_agent.security.auth - DEBUG - Google Client ID configured: True
2025-02-04 20:58:08,774 - invoice_agent.security.auth - DEBUG - Google Client ID configured: True
2025-02-04 20:58:08,774 - invoice_agent.security.auth - DEBUG - Google Client Secret configured: True
2025-02-04 20:58:08,774 - invoice_agent.security.auth - DEBUG - Google Client Secret configured: True
2025-02-04 20:58:09,793 - __main__ - INFO - OAuth callback detected, handling authentication...
2025-02-04 20:58:09,793 - __main__ - INFO - OAuth callback detected with code
2025-02-04 20:58:09,794 - __main__ - DEBUG - Starting Google OAuth authentication flow
2025-02-04 20:58:09,794 - __main__ - DEBUG - Received query parameters: {'state': ['tCKUd_W6N18153Mzj1LKYc9FbbhallHFiMnZRPlC_eU'], 'code': ['4/0ASVgi3ISqm2moQloyEgKzRtGJZfdymbb2wlaizshVbouEPhjnYOnHSreLWn4Fd02zZSiWQ'], 'scope': ['email profile openid https://www.googleapis.com/auth/calendar.events https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email'], 'authuser': ['0'], 'prompt': ['consent']}
2025-02-04 20:58:09,794 - invoice_agent.security.auth - ERROR - Error in Google OAuth callback: 'NoneType' object is not subscriptable
Traceback (most recent call last):
  File "/Users/sailesh/Documents/GitHub/invoiceAgent/src/invoice_agent/security/auth.py", line 201, in handle_google_auth
    self.logger.error(f"State token mismatch. Expected: {self.current_state_token[:10]}..., Got: {state[:10]}...")
                                                         ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
TypeError: 'NoneType' object is not subscriptable
2025-02-04 20:58:09,796 - __main__ - DEBUG - Auth result received: False
2025-02-04 20:58:09,796 - __main__ - ERROR - Authentication failed - auth_result is None
2025-02-04 20:58:09,863 - invoice_agent.security.auth - INFO - AuthManager initialized with redirect URI: http://localhost:8502
2025-02-04 20:58:09,863 - invoice_agent.security.auth - INFO - Using Streamlit port: 8502
2025-02-04 20:58:09,864 - invoice_agent.security.auth - DEBUG - Google Client ID configured: True
2025-02-04 20:58:09,864 - invoice_agent.security.auth - DEBUG - Google Client Secret configured: True
2025-02-04 20:58:11,544 - invoice_agent.security.auth - INFO - AuthManager initialized with redirect URI: http://localhost:8502
2025-02-04 20:58:11,545 - invoice_agent.security.auth - INFO - Using Streamlit port: 8502
2025-02-04 20:58:11,545 - invoice_agent.security.auth - DEBUG - Google Client ID configured: True
2025-02-04 20:58:11,545 - invoice_agent.security.auth - DEBUG - Google Client Secret configured: True
2025-02-04 20:58:12,214 - __main__ - INFO - Initiating Google OAuth flow...
2025-02-04 20:58:12,214 - invoice_agent.security.auth - DEBUG - Generated new state token: ZKheEtkBRn...
2025-02-04 20:58:12,214 - invoice_agent.security.auth - DEBUG - Using redirect URI: http://localhost:8502
2025-02-04 20:58:12,214 - invoice_agent.security.auth - INFO - Generated auth URL with state token: ZKheEtkBRn...
2025-02-04 20:58:12,214 - invoice_agent.security.auth - DEBUG - Full auth URL: https://accounts.google.com/o/oauth2/v2/auth?client_id=183173833346-kmsle3f3phtd3f71jms96q3uvcoqv0vu.apps.googleusercontent.com&redirect_uri=http%3A%2F%2Flocalhost%3A8502&response_type=code&scope=openid+email+profile&access_type=offline&state=ZKheEtkBRnRUVjbT0DYHlz9o8N4tgHayTqsYUMrUBjI&prompt=consent&include_granted_scopes=true
2025-02-04 20:58:12,214 - __main__ - DEBUG - Generated auth URL: https://accounts.google.com/o/oauth2/v2/auth?client_id=183173833346-kmsle3f3phtd3f71jms96q3uvcoqv0vu.apps.googleusercontent.com&redirect_uri=http%3A%2F%2Flocalhost%3A8502&response_type=code&scope=openid+email+profile&access_type=offline&state=ZKheEtkBRnRUVjbT0DYHlz9o8N4tgHayTqsYUMrUBjI&prompt=consent&include_granted_scopes=true
2025-02-04 20:58:12,215 - __main__ - DEBUG - Session state before redirect: {'google_signin': True, 'authenticated': False, 'connection_attempts': 0, 'auth_flow_started': True, 'initialized': True, 'auth_error': None, 'last_activity': 1738720692.2133582, 'page': 'Dashboard', 'user_info': None}
2025-02-04 20:58:20,588 - invoice_agent.security.auth - INFO - AuthManager initialized with redirect URI: http://localhost:8502
2025-02-04 20:58:20,589 - invoice_agent.security.auth - INFO - Using Streamlit port: 8502
2025-02-04 20:58:20,589 - invoice_agent.security.auth - DEBUG - Google Client ID configured: True
2025-02-04 20:58:20,589 - invoice_agent.security.auth - DEBUG - Google Client Secret configured: True
2025-02-04 20:58:21,194 - __main__ - INFO - OAuth callback detected, handling authentication...
2025-02-04 20:58:21,195 - __main__ - INFO - OAuth callback detected with code
2025-02-04 20:58:21,195 - __main__ - DEBUG - Starting Google OAuth authentication flow
2025-02-04 20:58:21,195 - __main__ - DEBUG - Received query parameters: {'state': ['ZKheEtkBRnRUVjbT0DYHlz9o8N4tgHayTqsYUMrUBjI'], 'code': ['4/0ASVgi3IhxlX2E8i9BpOfx70LafK3eSujHnvZTqBBGQXOuTm2nAU8ujm2wRZnYmfALxW5_w'], 'scope': ['email profile openid https://www.googleapis.com/auth/calendar.events https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email'], 'authuser': ['0'], 'prompt': ['consent']}
2025-02-04 20:58:21,195 - invoice_agent.security.auth - ERROR - Error in Google OAuth callback: 'NoneType' object is not subscriptable
Traceback (most recent call last):
  File "/Users/sailesh/Documents/GitHub/invoiceAgent/src/invoice_agent/security/auth.py", line 201, in handle_google_auth
    self.logger.error(f"State token mismatch. Expected: {self.current_state_token[:10]}..., Got: {state[:10]}...")
                                                         ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
TypeError: 'NoneType' object is not subscriptable
2025-02-04 20:58:21,195 - __main__ - DEBUG - Auth result received: False
2025-02-04 20:58:21,195 - __main__ - ERROR - Authentication failed - auth_result is None
2025-02-04 20:58:21,267 - invoice_agent.security.auth - INFO - AuthManager initialized with redirect URI: http://localhost:8502
2025-02-04 20:58:21,267 - invoice_agent.security.auth - INFO - Using Streamlit port: 8502
2025-02-04 20:58:21,267 - invoice_agent.security.auth - DEBUG - Google Client ID configured: True
2025-02-04 20:58:21,268 - invoice_agent.security.auth - DEBUG - Google Client Secret configured: True
2025-02-04 20:59:44,981 - invoice_agent.security.auth - INFO - AuthManager initialized with redirect URI: http://localhost:8502
2025-02-04 20:59:44,981 - invoice_agent.security.auth - INFO - AuthManager initialized with redirect URI: http://localhost:8502
2025-02-04 20:59:44,981 - invoice_agent.security.auth - INFO - Using Streamlit port: 8502
2025-02-04 20:59:44,981 - invoice_agent.security.auth - INFO - Using Streamlit port: 8502
2025-02-04 20:59:44,981 - invoice_agent.security.auth - DEBUG - Google Client ID configured: True
2025-02-04 20:59:44,981 - invoice_agent.security.auth - DEBUG - Google Client ID configured: True
2025-02-04 20:59:44,982 - invoice_agent.security.auth - DEBUG - Google Client Secret configured: True
2025-02-04 20:59:44,982 - invoice_agent.security.auth - DEBUG - Google Client Secret configured: True
2025-02-04 20:59:47,259 - invoice_agent.security.auth - INFO - AuthManager initialized with redirect URI: http://localhost:8502
2025-02-04 20:59:47,259 - invoice_agent.security.auth - INFO - Using Streamlit port: 8502
2025-02-04 20:59:47,259 - invoice_agent.security.auth - DEBUG - Google Client ID configured: True
2025-02-04 20:59:47,259 - invoice_agent.security.auth - DEBUG - Google Client Secret configured: True
2025-02-04 20:59:49,242 - __main__ - INFO - Initiating Google OAuth flow...
2025-02-04 20:59:49,242 - invoice_agent.security.auth - DEBUG - Generated new state token: 19hm1-PRPN...
2025-02-04 20:59:49,242 - invoice_agent.security.auth - DEBUG - Using redirect URI: http://localhost:8502
2025-02-04 20:59:49,242 - invoice_agent.security.auth - INFO - Generated auth URL with state token: 19hm1-PRPN...
2025-02-04 20:59:49,243 - invoice_agent.security.auth - DEBUG - Full auth URL: https://accounts.google.com/o/oauth2/v2/auth?client_id=183173833346-kmsle3f3phtd3f71jms96q3uvcoqv0vu.apps.googleusercontent.com&redirect_uri=http%3A%2F%2Flocalhost%3A8502&response_type=code&scope=openid+email+profile&access_type=offline&state=19hm1-PRPN76CkPHCwiDUY3p0y24cKHGwt0yqkaTUzQ&prompt=consent&include_granted_scopes=true
2025-02-04 20:59:49,243 - __main__ - DEBUG - Generated auth URL: https://accounts.google.com/o/oauth2/v2/auth?client_id=183173833346-kmsle3f3phtd3f71jms96q3uvcoqv0vu.apps.googleusercontent.com&redirect_uri=http%3A%2F%2Flocalhost%3A8502&response_type=code&scope=openid+email+profile&access_type=offline&state=19hm1-PRPN76CkPHCwiDUY3p0y24cKHGwt0yqkaTUzQ&prompt=consent&include_granted_scopes=true
2025-02-04 20:59:49,243 - __main__ - DEBUG - Session state before redirect: {'google_signin': True, 'page': 'Dashboard', 'authenticated': False, 'user_info': None, 'initialized': True, 'last_activity': 1738720789.241379, 'connection_attempts': 0, 'auth_error': None, 'state_token': '19hm1-PRPN76CkPHCwiDUY3p0y24cKHGwt0yqkaTUzQ', 'auth_flow_started': True}
2025-02-04 20:59:58,263 - invoice_agent.security.auth - INFO - AuthManager initialized with redirect URI: http://localhost:8502
2025-02-04 20:59:58,263 - invoice_agent.security.auth - INFO - Using Streamlit port: 8502
2025-02-04 20:59:58,264 - invoice_agent.security.auth - DEBUG - Google Client ID configured: True
2025-02-04 20:59:58,264 - invoice_agent.security.auth - DEBUG - Google Client Secret configured: True
2025-02-04 20:59:59,129 - __main__ - INFO - OAuth callback detected, handling authentication...
2025-02-04 20:59:59,129 - __main__ - INFO - OAuth callback detected with code
2025-02-04 20:59:59,129 - __main__ - DEBUG - Starting Google OAuth authentication flow
2025-02-04 20:59:59,130 - __main__ - DEBUG - Received query parameters: {'state': ['19hm1-PRPN76CkPHCwiDUY3p0y24cKHGwt0yqkaTUzQ'], 'code': ['4/0ASVgi3LFyuBeoxl_Q0hz-yo0n36y1D4xLGLAOFMwhC8Rz4Cz0yc9qVzlgF3Q1-EgO39dgQ'], 'scope': ['email profile openid https://www.googleapis.com/auth/calendar.events https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email'], 'authuser': ['0'], 'prompt': ['consent']}
2025-02-04 20:59:59,130 - invoice_agent.security.auth - ERROR - No stored state token found in session
2025-02-04 20:59:59,130 - __main__ - DEBUG - Auth result received: False
2025-02-04 20:59:59,130 - __main__ - ERROR - Authentication failed - auth_result is None
2025-02-04 20:59:59,313 - invoice_agent.security.auth - INFO - AuthManager initialized with redirect URI: http://localhost:8502
2025-02-04 20:59:59,314 - invoice_agent.security.auth - INFO - Using Streamlit port: 8502
2025-02-04 20:59:59,314 - invoice_agent.security.auth - DEBUG - Google Client ID configured: True
2025-02-04 20:59:59,314 - invoice_agent.security.auth - DEBUG - Google Client Secret configured: True
2025-02-04 21:00:01,438 - invoice_agent.security.auth - INFO - AuthManager initialized with redirect URI: http://localhost:8502
2025-02-04 21:00:01,439 - invoice_agent.security.auth - INFO - Using Streamlit port: 8502
2025-02-04 21:00:01,439 - invoice_agent.security.auth - DEBUG - Google Client ID configured: True
2025-02-04 21:00:01,439 - invoice_agent.security.auth - DEBUG - Google Client Secret configured: True
2025-02-04 21:00:02,131 - __main__ - INFO - OAuth callback detected, handling authentication...
2025-02-04 21:00:02,131 - __main__ - INFO - OAuth callback detected with code
2025-02-04 21:00:02,131 - __main__ - DEBUG - Starting Google OAuth authentication flow
2025-02-04 21:00:02,132 - __main__ - DEBUG - Received query parameters: {'state': ['19hm1-PRPN76CkPHCwiDUY3p0y24cKHGwt0yqkaTUzQ'], 'code': ['4/0ASVgi3LFyuBeoxl_Q0hz-yo0n36y1D4xLGLAOFMwhC8Rz4Cz0yc9qVzlgF3Q1-EgO39dgQ'], 'scope': ['email profile openid https://www.googleapis.com/auth/calendar.events https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email'], 'authuser': ['0'], 'prompt': ['consent']}
2025-02-04 21:00:02,132 - invoice_agent.security.auth - ERROR - No stored state token found in session
2025-02-04 21:00:02,132 - __main__ - DEBUG - Auth result received: False
2025-02-04 21:00:02,132 - __main__ - ERROR - Authentication failed - auth_result is None
2025-02-04 21:00:02,202 - invoice_agent.security.auth - INFO - AuthManager initialized with redirect URI: http://localhost:8502
2025-02-04 21:00:02,202 - invoice_agent.security.auth - INFO - Using Streamlit port: 8502
2025-02-04 21:00:02,202 - invoice_agent.security.auth - DEBUG - Google Client ID configured: True
2025-02-04 21:00:02,202 - invoice_agent.security.auth - DEBUG - Google Client Secret configured: True
